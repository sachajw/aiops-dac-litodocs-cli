---
/**
 * Tabs - Tabbed content component
 * Usage:
 * <Tabs>
 *   <Tab title="npm">npm install package</Tab>
 *   <Tab title="yarn">yarn add package</Tab>
 * </Tabs>
 * 
 * Alt usage with items prop:
 * <Tabs items={['npm', 'yarn']}>
 *   <Tab>npm content</Tab>
 *   <Tab>yarn content</Tab>
 * </Tabs>
 */
interface Props {
  items?: string[];
  defaultIndex?: number;
}

const { items, defaultIndex = 0 } = Astro.props;
const id = `tabs-${Math.random().toString(36).slice(2, 9)}`;

// If items not provided, we'll extract titles from Tab children via client-side JS
const hasItemsProp = Array.isArray(items) && items.length > 0;
---

<div class="tabs-container not-prose" data-tabs-id={id} data-default-index={defaultIndex}>
  {hasItemsProp && (
    <div class="tabs-header" role="tablist">
      {items.map((item, index) => (
        <button
          role="tab"
          data-tab-index={index}
          class={`tab-button ${index === defaultIndex ? 'active' : ''}`}
          aria-selected={index === defaultIndex}
        >
          {item}
        </button>
      ))}
    </div>
  )}
  <div class="tabs-header dynamic-tabs" role="tablist" style={hasItemsProp ? 'display: none;' : ''}></div>
  <div class="tabs-content">
    <slot />
  </div>
</div>

<style>
  @reference "../../styles/global.css";
  .tabs-container {
    @apply my-6 rounded border border-border bg-card overflow-hidden;
  }
  
  .tabs-header {
    @apply flex border-b border-border bg-muted;
  }
  
  .tab-button {
    @apply px-4 py-2.5 text-sm font-medium text-muted-foreground transition-all duration-200;
    @apply hover:text-foreground hover:bg-accent;
    @apply border-b-2 border-transparent -mb-px;
  }
  
  .tab-button.active {
    @apply text-foreground border-b-2 border-primary bg-accent;
  }
  
  .tabs-content {
    @apply p-4;
  }
</style>

<script>
  function initTabs() {
    document.querySelectorAll('.tabs-container').forEach((container) => {
      const defaultIndex = parseInt(container.getAttribute('data-default-index') || '0');
      const dynamicHeader = container.querySelector('.dynamic-tabs');
      const staticHeader = container.querySelector('.tabs-header:not(.dynamic-tabs)');
      const panels = container.querySelectorAll('.tab-panel');
      
      // Check if we need to build tabs from Tab children
      if (dynamicHeader && panels.length > 0 && !dynamicHeader.hasChildNodes()) {
        // Extract titles from Tab children
        panels.forEach((panel, index) => {
          const title = panel.getAttribute('data-title') || `Tab ${index + 1}`;
          const button = document.createElement('button');
          button.setAttribute('role', 'tab');
          button.setAttribute('data-tab-index', String(index));
          button.className = `tab-button ${index === defaultIndex ? 'active' : ''}`;
          button.setAttribute('aria-selected', String(index === defaultIndex));
          button.textContent = title;
          dynamicHeader.appendChild(button);
        });
        (dynamicHeader as HTMLElement).style.display = 'flex';
        if (staticHeader) (staticHeader as HTMLElement).style.display = 'none';
      }
      
      const buttons = container.querySelectorAll('[role="tab"]');
      
      // Initialize - show only the default tab
      panels.forEach((panel, index) => {
        (panel as HTMLElement).style.display = index === defaultIndex ? 'block' : 'none';
      });
      
      buttons.forEach((button) => {
        button.addEventListener('click', () => {
          const index = parseInt((button as HTMLElement).dataset.tabIndex || '0');
          
          // Update buttons
          buttons.forEach((btn, i) => {
            btn.classList.toggle('active', i === index);
            btn.setAttribute('aria-selected', String(i === index));
          });
          
          // Update panels
          panels.forEach((panel, i) => {
            (panel as HTMLElement).style.display = i === index ? 'block' : 'none';
          });
        });
      });
    });
  }
  
  initTabs();
  document.addEventListener('astro:page-load', initTabs);
</script>
