---
/**
 * CodeGroup - Tabbed code blocks for multiple languages
 * Usage:
 * <CodeGroup>
 *   ```bash title="npm"
 *   npm install package
 *   ```
 *   ```bash title="yarn"
 *   yarn add package
 *   ```
 * </CodeGroup>
 */
---

<div class="code-group not-prose">
  <div class="code-group-header" role="tablist"></div>
  <div class="code-group-content">
    <slot />
  </div>
</div>

<style>
  @reference "../../styles/global.css";
  .code-group {
    @apply my-6 rounded border border-border bg-card overflow-hidden;
  }
  
  .code-group-header {
    @apply flex border-b border-border bg-muted px-2;
  }
  
  .code-group-header :global(button) {
    @apply px-3 py-2 text-xs font-medium text-muted-foreground transition-colors;
    @apply hover:text-foreground border-b-2 border-transparent -mb-px;
  }
  
  .code-group-header :global(button.active) {
    @apply text-foreground border-primary;
  }
  
  .code-group-content {
    @apply relative;
  }
  
  .code-group-content :global(pre) {
    @apply m-0 rounded-none border-0 bg-transparent;
  }
  
  .code-group-content :global(.code-block) {
    @apply hidden;
  }
  
  .code-group-content :global(.code-block.active) {
    @apply block;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.code-group').forEach((group) => {
      const header = group.querySelector('.code-group-header');
      const content = group.querySelector('.code-group-content');
      const blocks = content?.querySelectorAll(':scope > pre, :scope > div > pre');
      
      if (!header || !blocks || blocks.length === 0) return;
      
      // Extract titles and create tabs
      blocks.forEach((block, index) => {
        const wrapper = document.createElement('div');
        wrapper.className = `code-block ${index === 0 ? 'active' : ''}`;
        block.parentNode?.insertBefore(wrapper, block);
        wrapper.appendChild(block);
        
        // Get title from code block or default to language
        const langClass = block.className.match(/language-(\w+)/);
        const title = (block as HTMLElement).dataset.title || langClass?.[1] || `Tab ${index + 1}`;
        
        const btn = document.createElement('button');
        btn.textContent = title;
        btn.className = index === 0 ? 'active' : '';
        btn.setAttribute('role', 'tab');
        btn.addEventListener('click', () => {
          header.querySelectorAll('button').forEach(b => b.classList.remove('active'));
          content?.querySelectorAll('.code-block').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          wrapper.classList.add('active');
        });
        header.appendChild(btn);
      });
    });
  });
</script>
